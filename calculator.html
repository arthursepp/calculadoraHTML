<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <title>Calculator</title>

    <style>
        .cabecalho {            
            width: 50%;
            margin: auto;
            margin-top: 10px;
            text-align: center;
        }        
    </style>    

</head>
<body>

    <div class="cabecalho w3-container w3-border">
        <h3>Calculadora</h3>
    </div>

    <br>

    <!-- Corpo -->
    <div class="w3-container">
        
        <!-- Calculadora -->
        <div class="w3-container w3-border w3-border-black calculator w3-display-middle w3-padding-24">
            <div class="w3-container w3-center">
                <input type="text" name="" id="visor" readonly>
            </div>

            <div class="w3-container w3-center linha1">
                <br>
                <button type="button" class="w3-button w3-gray" id="porcentagem"><i class="fa fa-percent"></i></button>                
                <button type="button" class="w3-button w3-red" id="clear">C</button>
                <button type="button" class="w3-button w3-red" id="delete" style="width: 100px;"><i class="fa fa-backspace"></i></button>
            </div>

            <div class="w3-container w3-center linha2">
                <br>
                <button type="button" class="w3-button w3-gray" id="sete"><b>7</b></button>
                <button type="button" class="w3-button w3-gray" id="oito"><b>8</b></button>
                <button type="button" class="w3-button w3-gray" id="nove"><b>9</b></button>
                <button type="button" class="w3-button w3-blue" id="soma"><i class="fa fa-plus"></i></button>
            </div>

            <div class="w3-container w3-center linha3">
                <br>
                <button type="button" class="w3-button w3-gray" id="quatro"><b>4</b></button>
                <button type="button" class="w3-button w3-gray" id="cinco"><b>5</b></button>
                <button type="button" class="w3-button w3-gray" id="seis"><b>6</b></button>
                <button type="button" class="w3-button w3-blue" id="subtract"><i class="fa fa-minus"></i></button>
            </div>

            <div class="w3-container w3-center linha4">
                <br>
                <button type="button" class="w3-button w3-gray" id="um"><b>1</b></button>
                <button type="button" class="w3-button w3-gray" id="dois"><b>2</b></button>
                <button type="button" class="w3-button w3-gray" id="tres"><b>3</b></button>
                <button type="button" class="w3-button w3-blue" id="multiplic"><i class="fa fa-times"></i></button>
            </div>

            <div class="w3-container w3-center linha5">
                <br>                
                <button type="button" class="w3-button w3-gray" id="negativar"><b>(<i class="fa fa-minus"></i>)</b></button>
                <button type="button" class="w3-button w3-gray" id="zero"><b>0</b></button>
                <button type="button" class="w3-button w3-gray" id="decimal"><b>.</b></button>
                <button type="button" class="w3-button w3-blue" id="divide"><i class="fa fa-divide"></i></button>
            </div>

            <div class="w3-container w3-center">
                <br>
                <button type="button" class="w3-button w3-blue" id="equals" style="width: 200px"><i class="fa fa-equals"></i></button>
            </div>

        </div>

    </div>

    <script>

        // Visor
        const visor = document.getElementById('visor');
    
        // Números
        const um = document.getElementById('um');
        const dois = document.getElementById('dois');
        const tres = document.getElementById('tres');
        const quatro = document.getElementById('quatro');
        const cinco = document.getElementById('cinco');
        const seis = document.getElementById('seis');
        const sete = document.getElementById('sete');
        const oito = document.getElementById('oito');
        const nove = document.getElementById('nove');
        const zero = document.getElementById('zero');
    
        // Operações
        const soma = document.getElementById('soma');
        const subtract = document.getElementById('subtract');
        const multiplic = document.getElementById('multiplic');
        const divide = document.getElementById('divide');
        const porcentagem = document.getElementById('porcentagem');
        const negativar = document.getElementById('negativar');
        const decimal = document.getElementById('decimal');
    
        // Outros
        const clear = document.getElementById('clear');
        const equals = document.getElementById('equals');
        const backspace = document.getElementById('delete');
        
        // Estrutura modificada para armazenar números com seus operadores
        let operacoes = [];
        let operadorAtual = '';
    
        um.addEventListener('click', function() {
            visor.value += '1';
            console.log('Número 1 pressionado');
        });
    
        dois.addEventListener('click', function() {
            visor.value += '2';
            console.log('Número 2 pressionado');
        });
    
        tres.addEventListener('click', function() {
            visor.value += '3';
            console.log('Número 3 pressionado');
        });
    
        quatro.addEventListener('click', function() {
            visor.value += '4';
            console.log('Número 4 pressionado');
        });
    
        cinco.addEventListener('click', function() {
            visor.value += '5';
            console.log('Número 5 pressionado');
        });
    
        seis.addEventListener('click', function() {
            visor.value += '6';
            console.log('Número 6 pressionado');
        });
    
        sete.addEventListener('click', function() {
            visor.value += '7';
            console.log('Número 7 pressionado');
        });
    
        oito.addEventListener('click', function() {
            visor.value += '8';
            console.log('Número 8 pressionado');
        });
    
        nove.addEventListener('click', function() {
            visor.value += '9';
            console.log('Número 9 pressionado');
        });
    
        zero.addEventListener('click', function() {
            visor.value += '0';
            console.log('Número 0 pressionado');
        });
    
        decimal.addEventListener('click', function() {
            if (!visor.value.includes('.')) {
                visor.value += '.';
                console.log('Decimal pressionado');
            }
        });
    
        function handleOperation(selectedOperator) {
            if (visor.value !== '') {
                // Adiciona o número atual e o último operador selecionado à lista de operações
                operacoes.push({ numero: visor.value, operador: operadorAtual });
                console.log('Número adicionado: ', visor.value);
                console.log('Operador anterior: ', operadorAtual);
                // Limpa o visor para a próxima entrada de número
                visor.value = '';
                // Atualiza o operador atual para o novo selecionado
                operadorAtual = selectedOperator;
                console.log('Operador atualizado: ', operadorAtual);
            } else if (operacoes.length > 0 && operadorAtual !== '') {
                // Permite a mudança de operador se o usuário selecionar um novo sem entrar um novo número
                operadorAtual = selectedOperator;
                console.log('Operador mudado: ', operadorAtual);
            }
        }
    
        soma.addEventListener('click', function() {
            handleOperation('+');
            console.log('Soma pressionado');
        });
    
        subtract.addEventListener('click', function() {
            handleOperation('-');
            console.log('Subtração pressionado');
        });
    
        multiplic.addEventListener('click', function() {
            handleOperation('×');
            console.log('Multiplicação pressionado');
        });
    
        divide.addEventListener('click', function() {
            handleOperation('÷');
            console.log('Divisão pressionado');
        });
    
        equals.addEventListener('click', function() {
            if (visor.value !== '') {
                operacoes.push({ numero: visor.value, operador: operadorAtual });
                console.log('Último número adicionado para cálculo: ', visor.value);
                console.log('Iniciando cálculo...');
                // Primeiro, calcular multiplicação e divisão
                for (let i = 0; i < operacoes.length; i++) {
                    if (operacoes[i].operador === '×' || operacoes[i].operador === '÷') {
                        const resultado = operacoes[i].operador === '×' ?
                            parseFloat(operacoes[i - 1].numero) * parseFloat(operacoes[i].numero) :
                            parseFloat(operacoes[i - 1].numero) / parseFloat(operacoes[i].numero);
                        console.log(`Resultado ${operacoes[i].operador}: ${resultado}`);
                        // Atualizar o número resultante na posição anterior
                        operacoes[i - 1].numero = resultado.toString();
                        // Remover a operação atual que já foi processada
                        operacoes.splice(i, 1);
                        i--; // Ajustar o índice após a remoção
                    }
                }
                // Depois, calcular adição e subtração
                let resultadoFinal = parseFloat(operacoes[0].numero);
                for (let i = 1; i < operacoes.length; i++) {
                    switch (operacoes[i].operador) {
                        case '+':
                            resultadoFinal += parseFloat(operacoes[i].numero);
                            console.log(`Somando: ${resultadoFinal}`);
                            break;
                        case '-':
                            resultadoFinal -= parseFloat(operacoes[i].numero);
                            console.log(`Subtraindo: ${resultadoFinal}`);
                            break;
                    }
                }
                visor.value = resultadoFinal;
                console.log('Resultado final: ', resultadoFinal);
                operacoes = [];
                operadorAtual = '';
            }
        });
    
        porcentagem.addEventListener('click', function() {
            if (visor.value !== '') {
                visor.value = (parseFloat(visor.value) / 100).toString();
                console.log('Porcentagem aplicada: ', visor.value);
            }
        });

        negativar.addEventListener('click', function() {
            if (visor.value !== '') {
                visor.value = (parseFloat(visor.value) * -1).toString();
                console.log('Valor negativado: ', visor.value);
            }
        });

        clear.addEventListener('click', function() {
            visor.value = "";
            operacoes = [];
            operadorAtual = '';
            console.log('Visor limpo');
        });
    
        backspace.addEventListener('click', function() {
            visor.value = visor.value.slice(0, -1);
            console.log('Backspace pressionado');
        });
    
    </script>
    

</body>
</html>